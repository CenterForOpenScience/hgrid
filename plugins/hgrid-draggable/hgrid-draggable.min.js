!function(e,t){"function"==typeof define&&define.amd?define(["jquery","hgrid"],t):"object"==typeof module?module.exports=t(jQuery,HGrid):t(jQuery,HGrid)}(this,function(e,t){return this.Draggable=function(e,t){"use strict";function r(t){var r=this;r.grid=null,r.options=e.extend({},n,t),r.rowMoveManager=null,r._folderTarget=null}var o={cancelEditOnDrag:!0},n={onDrop:function(){},onDrag:function(){},onBeforeDrag:function(){},onBeforeDrop:function(){},acceptDrop:function(){},dropError:function(e,r,o){throw new t.Error(o)},canDrag:function(e){return e.kind===t.FOLDER?!1:!0},canAcceptDrop:function(){},enableMove:!0,rowMoveManagerOptions:{},rowSelectionModelOptions:{}};return r.prototype.setTarget=function(e){this._folderTarget=e},r.prototype.clearTarget=function(){this._folderTarget=null},r.prototype.init=function(r){var n=this;n.grid=r;var i=r.getData(),a=r.getDataView(),s=r.grid,c=n.options.rowSelectionModelOptions;s.setSelectionModel(new t.RowSelectionModel(c));var l=e.extend({},o,n.options.rowMoveManagerOptions);n.rowMoveManager=new t.RowMoveManager(l);var g=function(e,t){var r=t.items,o=t.insertBefore;return n.options.onBeforeDrag.call(n,e,r,o)},u=function(t,o){r.removeHighlight();var i,a,c=(o.rows,o.insertBefore),l=o.items,g=function(e){return function(t){return t?n.options.dropError.call(n,e,n._folderTarget,t):void 0}};for(i=0,a=null;a=l[i];i++){var u=g(a,n._folderTarget);n.options.acceptDrop.call(n,a,n._folderTarget,u)}var f=n.options.onBeforeDrop.call(n,t,l,n._folderTarget,c);if(f===!1)return!1;var d;if(n._folderTarget){var v=n._folderTarget.id;d=l.map(function(t){var r=e.extend({},t);return r.parentID=v,delete r.depth,delete r._node,r})}else d=[];if(n.options.enableMove){for(i=0,a=null;a=l[i];i++)r.removeItem(a.id);r.addItems(d),s.resetActiveCell(),s.setSelectedRows([]),s.render()}n.options.onDrop.call(n,t,l,n._folderTarget,c)},f=function(t,r){var o=s.getCellFromEvent(t);if(o&&(r.row=o.row,i[r.row]&&!Slick.GlobalEditorLock.isActive())){t.stopImmediatePropagation();var n=s.getSelectedRows();n.length&&-1!==e.inArray(r.row,n)||(n=[r.row],s.setSelectedRows(n)),r.rows=n,r.count=n.length}},d=function(e){var o,n=r.grid.getDataItem(e-1);if(n.kind===t.FOLDER)o=n;else{var i=a.getLength(),s=e>i-1?i-1:e,c=r.grid.getDataItem(s);o=r.getByID(c.parentID)}return o},v=function(e,t){var o,i=t.items,a=t.insertBefore;if(t.insertBefore){o=d(t.insertBefore);for(var s=0;s<i.length;s++){var c=i[s]._node;if(c.id===o.id)return!1;if(c.children)for(var l=0;l<c.children.length;l++){var g=c.children[l];if(o.id===g.id)return n.clearTarget(),r.removeHighlight(),!1}}if(n.options.canAcceptDrop.call(n,i,o)===!1)return n.clearTarget(),r.removeHighlight(),!1;o&&(n.setTarget(o),r.addHighlight(n._folderTarget))}n.options.onDrag.call(n,e,t.items,o,a)},p=function(e){return n.options.canDrag.call(n,e)};n.rowMoveManager.onBeforeDragRows.subscribe(g),n.rowMoveManager.onMoveRows.subscribe(u),n.rowMoveManager.onDragRows.subscribe(v),n.rowMoveManager.canDrag=p,s.registerPlugin(n.rowMoveManager),s.onDragInit.subscribe(function(e){e.stopImmediatePropagation}),s.onDragStart.subscribe(f)},r.prototype.destroy=function(){this.rowMoveManager.destroy(),t.Col.Name.behavior=null},t.Draggable=r,r}.call(this,jQuery,t),function(e,t){"use strict";function r(t){function r(r){t=e.extend(!0,{},d,t),c=r,l=c.getCanvasNode(),f.subscribe(c.onDragInit,n).subscribe(c.onDragStart,i).subscribe(c.onDrag,a).subscribe(c.onDragEnd,s)}function o(){f.unsubscribeAll()}function n(e){e.stopImmediatePropagation()}function i(r,o){var n=c.getCellFromEvent(r);if(t.cancelEditOnDrag&&c.getEditorLock().isActive()&&c.getEditorLock().cancelCurrentEdit(),c.getEditorLock().isActive()||!/move|selectAndMove/.test(c.getColumns()[n.cell].behavior))return!1;g=!0,r.stopImmediatePropagation();var i=c.getSelectedRows();(0===i.length||-1===e.inArray(n.row,i))&&(i=[n.row],c.setSelectedRows(i));var a=c.getOptions().rowHeight;o.selectedRows=i;for(var s,f=o.selectedRows.map(function(e){return c.getData().getItemByIdx(e)}),d=0;s=f[d];d++)if(u.canDrag(s)===!1)return!1;o.selectionProxy=e('<div class="'+t.proxyClass+'"/>').css("position","absolute").css("zIndex","99999").css("width",e(l).innerWidth()).css("height",a*i.length).appendTo(l),t.enableReorder&&(o.guide=e('<div class="'+t.guideClass+'"/>').css("position","absolute").css("zIndex","99998").css("width",e(l).innerWidth()).css("top",-1e3).appendTo(l)),o.insertBefore=-1,u.onDragRowsStart.notify({rows:o.selectedRows,items:f})}function a(r,o){if(g){r.stopImmediatePropagation();var n=r.pageY-e(l).offset().top+c.getOptions().rowHeight/2;o.selectionProxy.css("top",n-c.getOptions().rowHeight);var i=Math.max(0,Math.min(Math.round(n/c.getOptions().rowHeight),c.getDataLength())),a=o.selectedRows.map(function(e){return c.getDataItem(e)});if(o.movedItems=a,i!==o.insertBefore){var s={rows:o.selectedRows,insertBefore:i,items:o.movedItems};u.onBeforeDragRows.notify(s)===!1?(t.enableReorder&&o.guide.css("top",-1e3),o.canMove=!1):(t.enableReorder&&o.guide.css("top",i*c.getOptions().rowHeight),o.canMove=!0),o.insertBefore=i}u.onDragRows.notify({rows:o.selectedRows,insertBefore:o.insertBefore,items:a})}}function s(e,r){if(e.stopImmediatePropagation(),r.selectionProxy.remove(),!g)return void r.selectionProxy.remove();if(g=!1,t.enableReorder&&r.guide.remove(),r.canMove){var o={rows:r.selectedRows,items:r.movedItems,insertBefore:r.insertBefore};u.onMoveRows.notify(o)}}var c,l,g,u=this,f=new Slick.EventHandler,d={cancelEditOnDrag:!1,enableReorder:!1,proxyClass:"slick-reorder-proxy",guideClass:"slick-reorder-guide"},v=function(){g=!1};e.extend(this,{onDragRowsStart:new Slick.Event,onBeforeDragRows:new Slick.Event,onMoveRows:new Slick.Event,onDragRows:new Slick.Event,canDrag:function(){return!0},init:r,destroy:o,cancelDrag:v})}t.RowMoveManager=r}(jQuery,t),function(e,t){"use strict";function r(t){function r(r){m=e.extend(!0,{},b,t),w=r,R.subscribe(w.onActiveCellChanged,n(d)),R.subscribe(w.onKeyDown,n(v)),R.subscribe(w.onClick,n(p))}function o(){R.unsubscribeAll()}function n(e){return function(){h||(h=!0,e.apply(this,arguments),h=!1)}}function i(e){for(var t=[],r=0;r<e.length;r++)for(var o=e[r].fromRow;o<=e[r].toRow;o++)t.push(o);return t}function a(e){for(var t=[],r=w.getColumns().length-1,o=0;o<e.length;o++)t.push(new Slick.Range(e[o],0,e[o],r));return t}function s(e,t){var r,o=[];for(r=e;t>=r;r++)o.push(r);for(r=t;e>r;r++)o.push(r);return o}function c(){return i(D)}function l(e){var t,r=[],o=e[e.length-1],n=w.getData(),i=n.getItem(o);if("undefined"!=typeof i){var a=i.parentID;for(t=0;t<e.length;t++){var s=n.getItem(e[t]);s.parentID===a&&r.push(e[t])}}return r}function g(e){u(a(l(e)))}function u(e){D=e,y.onSelectedRangesChanged.notify(D)}function f(){return D}function d(e,t){m.selectActiveRow&&null!=t.row&&u([new Slick.Range(t.row,0,t.row,w.getColumns().length-1)])}function v(e){var t=w.getActiveCell();if(t&&e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&(38===e.which||40===e.which)){var r=c();r.sort(function(e,t){return e-t}),r.length||(r=[t.row]);var o,n=r[0],i=r[r.length-1];o=40===e.which?t.row<i||n===i?++i:++n:t.row<i?--i:--n,o>=0&&o<w.getDataLength()&&(w.scrollRowIntoView(o),D=a(s(n,i)),u(D)),e.preventDefault(),e.stopPropagation()}}function p(t){var r=w.getCellFromEvent(t);if(!r||!w.canCellBeActive(r.row,r.cell))return!1;if(!w.getOptions().multiSelect||!t.ctrlKey&&!t.shiftKey&&!t.metaKey)return!1;var o=i(D),n=e.inArray(r.row,o);if(-1===n&&(t.ctrlKey||t.metaKey))o.push(r.row),w.setActiveCell(r.row,r.cell);else if(-1!==n&&(t.ctrlKey||t.metaKey))o=e.grep(o,function(e){return e!==r.row}),w.setActiveCell(r.row,r.cell);else if(o.length&&t.shiftKey){var s=o.pop(),c=Math.min(r.row,s),g=Math.max(r.row,s);o=[];for(var f=c;g>=f;f++)f!==s&&o.push(f);o.push(s),w.setActiveCell(r.row,r.cell)}return D=a(l(o)),u(D),t.stopImmediatePropagation(),!0}var w,h,m,D=[],y=this,R=new Slick.EventHandler,b={selectActiveRow:!0};e.extend(this,{getSelectedRows:c,setSelectedRows:g,getSelectedRanges:f,setSelectedRanges:u,init:r,destroy:o,onSelectedRangesChanged:new Slick.Event})}t.RowSelectionModel=r}(jQuery,t),Draggable});