!function(e,t){"function"==typeof define&&define.amd?define(["jquery","hgrid"],t):"object"==typeof module?module.exports=t(jQuery,HGrid):t(jQuery,HGrid)}(this,function(e,t){return this.Draggable=function(e,t){"use strict";function o(t){var o=this;o.grid=null,o.options=e.extend({},n,t),o.rowMoveManager=null,o._folderTarget=null}var r={cancelEditOnDrag:!0},n={onDrop:function(){},onDrag:function(){},onBeforeDrag:function(){},onBeforeDrop:function(){},acceptDrop:function(){},canDrag:function(e){return e.kind===t.FOLDER?!1:!0},canAcceptDrop:function(){},enableMove:!0,rowMoveManagerOptions:{},rowSelectionModelOptions:{}};return o.prototype.setTarget=function(e){this._folderTarget=e},o.prototype.clearTarget=function(){this._folderTarget=null},o.prototype.init=function(o){var n=this;n.grid=o;var i=o.getData(),a=o.getDataView(),s=o.grid,c=n.options.rowSelectionModelOptions;s.setSelectionModel(new t.RowSelectionModel(c));var l=e.extend({},r,n.options.rowMoveManagerOptions);n.rowMoveManager=new t.RowMoveManager(l);var g=function(e,t){var o=t.items,r=t.insertBefore;return n.options.onBeforeDrag.call(n,e,o,r)},u=function(r,i){o.removeHighlight();var a,c,l=(i.rows,i.insertBefore),g=i.items,u=function(e){if(e)throw new t.Error(e)};for(a=0,c=null;c=g[a];a++)n.options.acceptDrop.call(n,c,n._folderTarget,u);var f=n.options.onBeforeDrop.call(n,r,g,n._folderTarget,l);if(f===!1)return!1;var d=n._folderTarget.id,p=g.map(function(t){var o=e.extend({},t);return o.parentID=d,delete o.depth,delete o._node,o});if(n.options.enableMove){for(a=0,c=null;c=g[a];a++)o.removeItem(c.id);o.addItems(p),s.resetActiveCell(),s.setSelectedRows([]),s.render()}n.options.onDrop.call(n,r,g,n._folderTarget,l)},f=function(t,o){var r=s.getCellFromEvent(t);if(r&&(o.row=r.row,i[o.row]&&!Slick.GlobalEditorLock.isActive())){t.stopImmediatePropagation();var n=s.getSelectedRows();n.length&&-1!==e.inArray(o.row,n)||(n=[o.row],s.setSelectedRows(n)),o.rows=n,o.count=n.length}},d=function(e){var r=a.getItemByIdx(e-1);if(r.kind===t.FOLDER)parent=r;else{var n=a.getItemByIdx(e);parent=o.getByID(n.parentID)}return parent},p=function(e,t){var r,i=t.items,a=t.insertBefore;if(t.insertBefore){if(r=d(t.insertBefore),n.options.canAcceptDrop.call(n,i,r)===!1)return n.clearTarget(),!1;r&&(n.setTarget(r),o.addHighlight(n._folderTarget))}n.options.onDrag.call(n,e,t.items,r,a)},w=function(e){return n.options.canDrag.call(n,e)};n.rowMoveManager.onBeforeDragRows.subscribe(g),n.rowMoveManager.onMoveRows.subscribe(u),n.rowMoveManager.onDragRows.subscribe(p),n.rowMoveManager.canDrag=w,s.registerPlugin(n.rowMoveManager),s.onDragInit.subscribe(function(e){e.stopImmediatePropagation}),s.onDragStart.subscribe(f)},o.prototype.destroy=function(){this.rowMoveManager.destroy(),t.Col.Name.behavior=null},t.Draggable=o,o}.call(this,jQuery,t),function(e,t){"use strict";function o(t){function o(o){t=e.extend(!0,{},d,t),c=o,l=c.getCanvasNode(),f.subscribe(c.onDragInit,n).subscribe(c.onDragStart,i).subscribe(c.onDrag,a).subscribe(c.onDragEnd,s)}function r(){f.unsubscribeAll()}function n(e){e.stopImmediatePropagation()}function i(o,r){var n=c.getCellFromEvent(o);if(t.cancelEditOnDrag&&c.getEditorLock().isActive()&&c.getEditorLock().cancelCurrentEdit(),c.getEditorLock().isActive()||!/move|selectAndMove/.test(c.getColumns()[n.cell].behavior))return!1;g=!0,o.stopImmediatePropagation();var i=c.getSelectedRows();(0===i.length||-1===e.inArray(n.row,i))&&(i=[n.row],c.setSelectedRows(i));var a=c.getOptions().rowHeight;r.selectedRows=i;for(var s,f=r.selectedRows.map(function(e){return c.getData().getItemByIdx(e)}),d=0;s=f[d];d++)if(u.canDrag(s)===!1)return!1;r.selectionProxy=e('<div class="'+t.proxyClass+'"/>').css("position","absolute").css("zIndex","99999").css("width",e(l).innerWidth()).css("height",a*i.length).appendTo(l),t.enableReorder&&(r.guide=e('<div class="'+t.guideClass+'"/>').css("position","absolute").css("zIndex","99998").css("width",e(l).innerWidth()).css("top",-1e3).appendTo(l)),r.insertBefore=-1,u.onDragRowsStart.notify({rows:r.selectedRows,items:f})}function a(o,r){if(g){o.stopImmediatePropagation();var n=o.pageY-e(l).offset().top;r.selectionProxy.css("top",n-5);var i=Math.max(0,Math.min(Math.round(n/c.getOptions().rowHeight),c.getDataLength())),a=r.selectedRows.map(function(e){return c.getData().getItemByIdx(e)});if(r.movedItems=a,i!==r.insertBefore){var s={rows:r.selectedRows,insertBefore:i,items:r.movedItems};u.onBeforeDragRows.notify(s)===!1?(t.enableReorder&&r.guide.css("top",-1e3),r.canMove=!1):(t.enableReorder&&r.guide.css("top",i*c.getOptions().rowHeight),r.canMove=!0),r.insertBefore=i}u.onDragRows.notify({rows:r.selectedRows,insertBefore:r.insertBefore,items:a})}}function s(e,o){if(g&&(g=!1,e.stopImmediatePropagation(),t.enableReorder&&o.guide.remove(),o.selectionProxy.remove(),o.canMove)){var r={rows:o.selectedRows,items:o.movedItems,insertBefore:o.insertBefore};u.onMoveRows.notify(r)}}var c,l,g,u=this,f=new Slick.EventHandler,d={cancelEditOnDrag:!1,enableReorder:!1,proxyClass:"slick-reorder-proxy",guideClass:"slick-reorder-guide"};e.extend(this,{onDragRowsStart:new Slick.Event,onBeforeDragRows:new Slick.Event,onMoveRows:new Slick.Event,onDragRows:new Slick.Event,canDrag:function(){return!0},init:o,destroy:r})}t.RowMoveManager=o}(jQuery,t),function(e,t){"use strict";function o(t){function o(o){m=e.extend(!0,{},b,t),v=o,R.subscribe(v.onActiveCellChanged,n(d)),R.subscribe(v.onKeyDown,n(p)),R.subscribe(v.onClick,n(w))}function r(){R.unsubscribeAll()}function n(e){return function(){h||(h=!0,e.apply(this,arguments),h=!1)}}function i(e){for(var t=[],o=0;o<e.length;o++)for(var r=e[o].fromRow;r<=e[o].toRow;r++)t.push(r);return t}function a(e){for(var t=[],o=v.getColumns().length-1,r=0;r<e.length;r++)t.push(new Slick.Range(e[r],0,e[r],o));return t}function s(e,t){var o,r=[];for(o=e;t>=o;o++)r.push(o);for(o=t;e>o;o++)r.push(o);return r}function c(){return i(D)}function l(e){var t,o=[],r=e[e.length-1],n=v.getData(),i=n.getItem(r);if("undefined"!=typeof i){var a=i.parentID;for(t=0;t<e.length;t++){var s=n.getItem(e[t]);s.parentID===a&&o.push(e[t])}}return o}function g(e){u(a(l(e)))}function u(e){D=e,y.onSelectedRangesChanged.notify(D)}function f(){return D}function d(e,t){m.selectActiveRow&&null!=t.row&&u([new Slick.Range(t.row,0,t.row,v.getColumns().length-1)])}function p(e){var t=v.getActiveCell();if(t&&e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&(38===e.which||40===e.which)){var o=c();o.sort(function(e,t){return e-t}),o.length||(o=[t.row]);var r,n=o[0],i=o[o.length-1];r=40===e.which?t.row<i||n===i?++i:++n:t.row<i?--i:--n,r>=0&&r<v.getDataLength()&&(v.scrollRowIntoView(r),D=a(s(n,i)),u(D)),e.preventDefault(),e.stopPropagation()}}function w(t){var o=v.getCellFromEvent(t);if(!o||!v.canCellBeActive(o.row,o.cell))return!1;if(!v.getOptions().multiSelect||!t.ctrlKey&&!t.shiftKey&&!t.metaKey)return!1;var r=i(D),n=e.inArray(o.row,r);if(-1===n&&(t.ctrlKey||t.metaKey))r.push(o.row),v.setActiveCell(o.row,o.cell);else if(-1!==n&&(t.ctrlKey||t.metaKey))r=e.grep(r,function(e){return e!==o.row}),v.setActiveCell(o.row,o.cell);else if(r.length&&t.shiftKey){var s=r.pop(),c=Math.min(o.row,s),g=Math.max(o.row,s);r=[];for(var f=c;g>=f;f++)f!==s&&r.push(f);r.push(s),v.setActiveCell(o.row,o.cell)}return D=a(l(r)),u(D),t.stopImmediatePropagation(),!0}var v,h,m,D=[],y=this,R=new Slick.EventHandler,b={selectActiveRow:!0};e.extend(this,{getSelectedRows:c,setSelectedRows:g,getSelectedRanges:f,setSelectedRanges:u,init:o,destroy:r,onSelectedRangesChanged:new Slick.Event})}t.RowSelectionModel=o}(jQuery,t),Draggable});