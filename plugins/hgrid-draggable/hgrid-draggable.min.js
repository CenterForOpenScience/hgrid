!function(e,t){"function"==typeof define&&define.amd?define(["jquery","hgrid"],t):"object"==typeof module?module.exports=t(jQuery,HGrid):t(jQuery,HGrid)}(this,function(t,o){function n(e){var o=this;o.options=t.extend({},i,e),o.rowMoveManager=null}!function(e){function t(t){function o(o){t=e.extend(!0,{},w,t),a=o,l=a.getCanvasNode(),f.subscribe(a.onDragInit,r).subscribe(a.onDragStart,i).subscribe(a.onDrag,s).subscribe(a.onDragEnd,c)}function n(){f.unsubscribeAll()}function r(e){e.stopImmediatePropagation()}function i(o,n){var r=a.getCellFromEvent(o);if(t.cancelEditOnDrag&&a.getEditorLock().isActive()&&a.getEditorLock().cancelCurrentEdit(),a.getEditorLock().isActive()||!/move|selectAndMove/.test(a.getColumns()[r.cell].behavior))return!1;u=!0,o.stopImmediatePropagation();var i=a.getSelectedRows();(0==i.length||-1==e.inArray(r.row,i))&&(i=[r.row],a.setSelectedRows(i));var s=a.getOptions().rowHeight;n.selectedRows=i,n.selectionProxy=e("<div class='slick-reorder-proxy'/>").css("position","absolute").css("zIndex","99999").css("width",e(l).innerWidth()).css("height",s*i.length).appendTo(l),n.guide=e("<div class='slick-reorder-guide'/>").css("position","absolute").css("zIndex","99998").css("width",e(l).innerWidth()).css("top",-1e3).appendTo(l),n.insertBefore=-1}function s(t,o){if(u){t.stopImmediatePropagation();var n=t.pageY-e(l).offset().top;o.selectionProxy.css("top",n-5);var r=Math.max(0,Math.min(Math.round(n/a.getOptions().rowHeight),a.getDataLength()));if(r!==o.insertBefore){var i={rows:o.selectedRows,insertBefore:r};g.onBeforeMoveRows.notify(i)===!1?(o.guide.css("top",-1e3),o.canMove=!1):(o.guide.css("top",r*a.getOptions().rowHeight),o.canMove=!0),o.insertBefore=r}}}function c(e,t){if(u&&(u=!1,e.stopImmediatePropagation(),t.guide.remove(),t.selectionProxy.remove(),t.canMove)){var o={rows:t.selectedRows,insertBefore:t.insertBefore};g.onMoveRows.notify(o)}}var a,l,u,g=this,f=new Slick.EventHandler,w={cancelEditOnDrag:!1};e.extend(this,{onBeforeMoveRows:new Slick.Event,onMoveRows:new Slick.Event,init:o,destroy:n})}e.extend(!0,window,{Slick:{RowMoveManager:t}})}(jQuery),function(e){function t(t){function o(o){p=e.extend(!0,{},b,t),v=o,y.subscribe(v.onActiveCellChanged,r(f)),y.subscribe(v.onKeyDown,r(w)),y.subscribe(v.onClick,r(d))}function n(){y.unsubscribeAll()}function r(e){return function(){h||(h=!0,e.apply(this,arguments),h=!1)}}function i(e){for(var t=[],o=0;o<e.length;o++)for(var n=e[o].fromRow;n<=e[o].toRow;n++)t.push(n);return t}function s(e){for(var t=[],o=v.getColumns().length-1,n=0;n<e.length;n++)t.push(new Slick.Range(e[n],0,e[n],o));return t}function c(e,t){var o,n=[];for(o=e;t>=o;o++)n.push(o);for(o=t;e>o;o++)n.push(o);return n}function a(){return i(m)}function l(e){u(s(e))}function u(e){m=e,M.onSelectedRangesChanged.notify(m)}function g(){return m}function f(e,t){p.selectActiveRow&&null!=t.row&&u([new Slick.Range(t.row,0,t.row,v.getColumns().length-1)])}function w(e){var t=v.getActiveCell();if(t&&e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&(38==e.which||40==e.which)){var o=a();o.sort(function(e,t){return e-t}),o.length||(o=[t.row]);var n,r=o[0],i=o[o.length-1];n=40==e.which?t.row<i||r==i?++i:++r:t.row<i?--i:--r,n>=0&&n<v.getDataLength()&&(v.scrollRowIntoView(n),m=s(c(r,i)),u(m)),e.preventDefault(),e.stopPropagation()}}function d(t){var o=v.getCellFromEvent(t);if(!o||!v.canCellBeActive(o.row,o.cell))return!1;if(!v.getOptions().multiSelect||!t.ctrlKey&&!t.shiftKey&&!t.metaKey)return!1;var n=i(m),r=e.inArray(o.row,n);if(-1===r&&(t.ctrlKey||t.metaKey))n.push(o.row),v.setActiveCell(o.row,o.cell);else if(-1!==r&&(t.ctrlKey||t.metaKey))n=e.grep(n,function(e){return e!==o.row}),v.setActiveCell(o.row,o.cell);else if(n.length&&t.shiftKey){var c=n.pop(),a=Math.min(o.row,c),l=Math.max(o.row,c);n=[];for(var g=a;l>=g;g++)g!==c&&n.push(g);n.push(c),v.setActiveCell(o.row,o.cell)}return m=s(n),u(m),t.stopImmediatePropagation(),!0}var v,h,p,m=[],M=this,y=new Slick.EventHandler,b={selectActiveRow:!0};e.extend(this,{getSelectedRows:a,setSelectedRows:l,getSelectedRanges:g,setSelectedRanges:u,init:o,destroy:n,onSelectedRangesChanged:new Slick.Event})}e.extend(!0,window,{Slick:{RowSelectionModel:t}})}(jQuery);var r={cancelEditOnDrag:!0},i={draggableNameCol:!0,rowMoveManagerOptions:{}};return n.prototype.init=function(o){var n=this,i=o.getData(),s=o.grid;s.setSelectionModel(new Slick.RowSelectionModel);var c=t.extend({},r,n.options.rowMoveManagerOptions);n.rowMoveManager=new Slick.RowMoveManager(c),n.rowMoveManager.onBeforeMoveRows.subscribe(function(e,t){for(var o=0;o<t.rows.length;o++)if(t.rows[o]===t.insertBefore||t.rows[o]===t.insertBefore-1)return e.stopPropagation,!1}),n.rowMoveManager.onMoveRows.subscribe(function(e,t){var o=[],n=t.rows,r=t.insertBefore,c=i.slice(0,r),a=i.slice(r,i.length);n.sort(function(e,t){return e-t});var l;for(l=0;l<n.length;l++)o.push(i[n[l]]);for(n.reverse(),l=0;l<n.length;l++){var u=n[l];r>u?c.splice(u,1):a.splice(u-r,1)}i=c.concat(o.concat(a));var g=[];for(l=0;l<n.length;l++)g.push(c.length+l);s.resetActiveCell(),s.setData(i),s.setSelectedRows(g),s.render()}),s.registerPlugin(n.rowMoveManager),s.onDragInit.subscribe(function(e){e.stopImmediatePropagation}),s.onDragStart.subscribe(function(n,r){var c=s.getCellFromEvent(e);if(c&&(r.row=c.row,i[r.row]&&!Slick.GlobalEditorLock.isActive())){n.stopImmediatePropagation();var a=o.getSelectedRows();a.length&&-1!==t.inArray(r.row,a)||(a=[r.row],o.setSelectedRows(a)),r.rows=a,r.count=a.length}})},o.Draggable=n,n});